---
title: 【读书笔记】持续集成（软件质量改进和风险降低之道）之二
date: 2015-12-17
tags: 持续集成
---

# 持续集成（软件质量改进和风险降低之道）
## 第三章 利用CI减少风险

_品质意味着在没人看的时候也把事情做对。 by 亨利 福特_
- 我们的任务进度怎么样了？请查看最后一次构建
- 测试覆盖率达到多少？请查看最后一次构建
- 谁最后签入了代码？请查看最后一次构建

利用CI，对每次变更建立一张“品质安全网”，更快地交付软件产品。当你在每次变更时按下“集成按钮”时，你就为尽早发现风险、经常发现风险奠定了基础。

**3.1 风险：没有可部署的软件**

场景：“在我的机器上是可行的”
解决方案：消除IDE与构建过程的耦合，使用自动化构建脚本

场景：与数据库同步（害怕修改或重构数据库和源代码、很难用不同的测试数据填充数据库、很难维护开发和测试环境）
解决方案：将数据库相关融入到开发过程中，对数据库进行审查和测试

**3.2 风险：很晚才发现缺陷**

场景：对错误的修复导致了其它无关的错误浮现出来。我们对变更没有信心，因为我们不知道变更对其它部分的影响。
解决方案：为变更的代码编写单元测试。

**3.3 风险：缺少项目可见性**

场景：没有工具显示整个项目的总体设计情况，没有类和关系的模型。
解决方案：使用自动化文档生成工具。

**3.4 风险：低品质的软件**

场景：坚持编码标准
场景：维持架构标准
场景：重复的代码
解决方案：使用相关的开发工具:Checkstyle / PMD / jDepend / Simian
## 第四章 针对每次变更构建软件

_整个该死的宇宙必须被分解为一小块一小块，然后重新构造。 by 亨利 米勒_

有时候开发者就像鞋匠，为他的所有客户提供了鞋子，却忘记为他自己的孩子做鞋。

**4.1 自动化构建**

 要记住，构建应该是按一下按钮的事。

**4.2 执行单命令构建**

构建脚本的逻辑过程：
1. 清理
2. 编译
3. 集成数据库
4. 测试
5. 审查
6. 部署

**4.3 将构建脚本从IDE分离**

无

**4.4 集中放置软件资产**

使用版本库来存放所有文件。

**4.5 创建一致的目录结构**

基于软件开发过程中的活动创建一致的、有逻辑的目录结构。
构建过程中只需取出包含这个任务所需的源码和相关脚本，而不是所有的东西。

**4.6 让构建快速失败**

越有可能失败的的任务，应该越早在构建脚本中执行。

**4.7 针对所有环境构建**

改进构建脚本的可配置项，将构建脚本参数化。

**4.8 构建的类型和触发机制**

三个层次：个人、团队、客户。分别对应私有构建、集成构建、发布构建。
触发机制：手工、定期执行、轮询变更、事件驱动。

**4.9 使用专门的集成构建计算机**

无

**4.10 使用CI服务器**

典型的CI服务器包含如下功能：
- 以特定的时间间隔轮询版本库变更
- 定期执行某种操作
- 标识出安静期，在这段时间内部进行集成构建
- 支持不同的构建脚本
- 向相关人员发送电子邮件
- 显示构建历史
- 信息面板查看集成构建的信息
- 为不同的项目支持多个版本控制系统

**4.11 执行手工集成构建**

使用手工集成构建不能保证坚持持续集成的实践。不利于提高品质的、更小、更频繁的集成。

**4.12 执行快速构建**

保持构建不超过10分钟；收集、分析构建测量数据；改进测试性能。

**4.13 分阶段构建**

减少构建时间的一种方式。先执行轻量级构建并对软件进行单元测试，然后执行重量级构建。

**4.14 这对您如何生效**

_我的项目有七十亿行代码，怎么可能用这种方式？_

大项目主要考虑让构建保持迅速，定期执行而不是持续执行。将代码分解为独立的子项目。

_我们的软件太复杂了。我们 必须手工做一些事 或 “我们一切进行的的很好”_

这正是创建CI系统的理由，因为你可能在执行重复过程上花了很多时间。如果软件复杂，有很多依赖，那么持续集成就更有必要，需要创建一个系统将所有的部件组装在一起，执行测试和审查，确保所有部分运行正常。
当然，这并不是说创建一个可重复的构建过程会很容易。将过程分解，而不是一次加入所有CI包含的东西。

还有一点：CI是针对主线执行，分支必须在适当的时候合并到主线。
